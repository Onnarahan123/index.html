<!DOCTYPE html>
<html lang="et">
<head>
  <meta charset="UTF-8" />
  <title>Eesti elektrihind (15 min)</title>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0b1220;
      color: #fff;
      padding: 20px;
    }
    h1 {
      margin-bottom: 5px;
    }
    .muted {
      color: #9ca3af;
      font-size: 14px;
    }
    .card {
      background: #111827;
      padding: 20px;
      border-radius: 12px;
      margin-top: 20px;
    }
    canvas {
      background: #020617;
      border-radius: 10px;
      padding: 10px;
    }
    button {
      margin-top: 15px;
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      background: #38bdf8;
      font-weight: bold;
      cursor: pointer;
    }
  </style>
</head>

<body>

<h1>⚡ Eesti elektrihind</h1>
<div class="muted">15 minuti kaupa · allikas Elering</div>

<div class="card">
  <canvas id="priceChart"></canvas>
  <button onclick="loadData()">Uuenda andmed</button>
</div>

<script>
async function loadData() {
  const today = new Date();
  today.setHours(0,0,0,0);
  const tomorrow = new Date(today);
  tomorrow.setDate(today.getDate() + 1);

  const start = today.toISOString();
  const end = tomorrow.toISOString();

  const url = `https://dashboard.elering.ee/api/nps/price?start=${start}&end=${end}&fields=ee`;

  const response = await fetch(url);
  const json = await response.json();

  const data = json.data.ee;

  const labels = data.map(x =>
    new Date(x.timestamp * 1000).toLocaleTimeString("et-EE", {
      hour: "2-digit",
      minute: "2-digit"
    })
  );

  const prices = data.map(x => (x.price / 10).toFixed(2)); // snt/kWh

  if (window.chart) window.chart.destroy();

  const ctx = document.getElementById("priceChart");

  window.chart = new Chart(ctx, {
    type: "line",
    data: {
      labels: labels,
      datasets: [{
        label: "Hind (snt/kWh)",
        data: prices,
        borderColor: "#38bdf8",
        backgroundColor: "rgba(56,189,248,0.2)",
        tension: 0.3
      }]
    },
    options: {
      scales: {
        y: {
          ticks: {
            callback: v => v + " snt"
          }
        }
      }
    }
  });
}

loadData();
</script>

</body>
</html>
